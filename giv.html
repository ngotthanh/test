<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Giải mã AES với CryptoJS</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body>
    <h1>Giải mã AES với CryptoJS</h1>
    <input type="text" id="key" placeholder="Nhập khóa (16 ký tự)">
    <input type="text" id="ciphertext" placeholder="Nhập dữ liệu mã hóa">
    <button onclick="decrypt()">Giải mã</button>
    <h2>Kết quả giải mã:</h2>
    <p id="decrypted"></p>

    <script>
        function decrypt() {
            const keyInput = document.getElementById('key').value;
            const ciphertext = document.getElementById('ciphertext').value;

            // Kiểm tra độ dài khóa
            if (keyInput.length !== 16) {
                alert('Khóa phải có độ dài 16 ký tự!');
                return;
            }

            // Tách IV và dữ liệu mã hóa
            const parts = ciphertext.split(':');
            if (parts.length !== 2) {
                alert('Dữ liệu mã hóa không hợp lệ!');
                return;
            }

            const iv = CryptoJS.enc.Hex.parse(parts[0]); // IV là phần đầu tiên
            const encryptedData = parts[1]; // Dữ liệu mã hóa là phần thứ hai

            const key = CryptoJS.enc.Utf8.parse(keyInput); // Chuyển đổi khóa thành WordArray

            const decrypted = CryptoJS.AES.decrypt(encryptedData, key, {
                iv: iv,
                mode: CryptoJS.mode.CBC,
                padding: CryptoJS.pad.Pkcs7
            });

            const plaintext = decrypted.toString(CryptoJS.enc.Utf8); // Chuyển đổi kết quả về dạng chuỗi

            if (plaintext) {
                document.getElementById('decrypted').innerText = plaintext;
            } else {
                document.getElementById('decrypted').innerText = 'Giải mã không thành công!';
            }
        }
    </script>
</body>
</html>
